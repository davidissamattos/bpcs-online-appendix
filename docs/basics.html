<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Basic functionality | Online appendix for the paper: “Bayesian Paired-Comparison with the bpcs package”</title>
  <meta name="description" content="This is the online appendix for the paper: “Bayesian Paired-Comparison with the bpcs package.”" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Basic functionality | Online appendix for the paper: “Bayesian Paired-Comparison with the bpcs package”" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the online appendix for the paper: “Bayesian Paired-Comparison with the bpcs package.”" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Basic functionality | Online appendix for the paper: “Bayesian Paired-Comparison with the bpcs package”" />
  
  <meta name="twitter:description" content="This is the online appendix for the paper: “Bayesian Paired-Comparison with the bpcs package.”" />
  

<meta name="author" content="David Issa Mattos and Érika Martins Silva Ramos" />


<meta name="date" content="2021-06-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="studyI.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Foreword</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#installation-of-the-bpcs-package"><i class="fa fa-check"></i><b>1.1</b> Installation of the bpcs package</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#session-info"><i class="fa fa-check"></i><b>1.2</b> Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Basic functionality</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#reading-and-preparing-the-data"><i class="fa fa-check"></i><b>2.1</b> Reading and preparing the data</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#the-bayesian-bradley-terry-analysis"><i class="fa fa-check"></i><b>2.2</b> The Bayesian Bradley-Terry analysis</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="basics.html"><a href="basics.html#diagnostics"><i class="fa fa-check"></i><b>2.2.1</b> Diagnostics</a></li>
<li class="chapter" data-level="2.2.2" data-path="basics.html"><a href="basics.html#summary-information"><i class="fa fa-check"></i><b>2.2.2</b> Summary information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="studyI.html"><a href="studyI.html"><i class="fa fa-check"></i><b>3</b> Re-analysis 1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="studyI.html"><a href="studyI.html#importing-the-data"><i class="fa fa-check"></i><b>3.1</b> Importing the data</a></li>
<li class="chapter" data-level="3.2" data-path="studyI.html"><a href="studyI.html#analysis-with-the-bradley-terry-model-and-the-order-effect-model"><i class="fa fa-check"></i><b>3.2</b> Analysis with the Bradley-Terry model and the order effect model</a></li>
<li class="chapter" data-level="3.3" data-path="studyI.html"><a href="studyI.html#diagnostics-1"><i class="fa fa-check"></i><b>3.3</b> Diagnostics</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="studyI.html"><a href="studyI.html#tables-and-plots"><i class="fa fa-check"></i><b>3.3.1</b> Tables and plots</a></li>
<li class="chapter" data-level="3.3.2" data-path="studyI.html"><a href="studyI.html#waic"><i class="fa fa-check"></i><b>3.3.2</b> WAIC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="studyII.html"><a href="studyII.html"><i class="fa fa-check"></i><b>4</b> Re-analysis 2</a>
<ul>
<li class="chapter" data-level="4.1" data-path="studyII.html"><a href="studyII.html#importing-the-data-1"><i class="fa fa-check"></i><b>4.1</b> Importing the data</a></li>
<li class="chapter" data-level="4.2" data-path="studyII.html"><a href="studyII.html#simple-bradley-terry-model"><i class="fa fa-check"></i><b>4.2</b> Simple Bradley-Terry model</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="studyII.html"><a href="studyII.html#assessing-the-fitness-of-the-model"><i class="fa fa-check"></i><b>4.2.1</b> Assessing the fitness of the model</a></li>
<li class="chapter" data-level="4.2.2" data-path="studyII.html"><a href="studyII.html#getting-the-waic"><i class="fa fa-check"></i><b>4.2.2</b> Getting the WAIC</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="studyII.html"><a href="studyII.html#bradley-terry-model-with-random-effects-for-individuals"><i class="fa fa-check"></i><b>4.3</b> Bradley-Terry model with random effects for individuals</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="studyII.html"><a href="studyII.html#getting-the-waic-1"><i class="fa fa-check"></i><b>4.3.1</b> Getting the WAIC</a></li>
<li class="chapter" data-level="4.3.2" data-path="studyII.html"><a href="studyII.html#parameter-tables-and-plots"><i class="fa fa-check"></i><b>4.3.2</b> Parameter tables and plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="studyIII.html"><a href="studyIII.html"><i class="fa fa-check"></i><b>5</b> Re-analysis 3</a>
<ul>
<li class="chapter" data-level="5.1" data-path="studyIII.html"><a href="studyIII.html#importing-the-data-2"><i class="fa fa-check"></i><b>5.1</b> Importing the data</a></li>
<li class="chapter" data-level="5.2" data-path="studyIII.html"><a href="studyIII.html#simple-bradley-terry-models"><i class="fa fa-check"></i><b>5.2</b> Simple Bradley-Terry models</a></li>
<li class="chapter" data-level="5.3" data-path="studyIII.html"><a href="studyIII.html#subject-predictors-model"><i class="fa fa-check"></i><b>5.3</b> Subject predictors model</a></li>
<li class="chapter" data-level="5.4" data-path="studyIII.html"><a href="studyIII.html#subject-predictors-and-random-effects"><i class="fa fa-check"></i><b>5.4</b> Subject predictors and random effects</a></li>
<li class="chapter" data-level="5.5" data-path="studyIII.html"><a href="studyIII.html#comparing-the-waic"><i class="fa fa-check"></i><b>5.5</b> Comparing the WAIC</a></li>
<li class="chapter" data-level="5.6" data-path="studyIII.html"><a href="studyIII.html#plots-and-tables"><i class="fa fa-check"></i><b>5.6</b> Plots and tables</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="studyIII.html"><a href="studyIII.html#table-lambda-and-u"><i class="fa fa-check"></i><b>5.6.1</b> Table lambda and U</a></li>
<li class="chapter" data-level="5.6.2" data-path="studyIII.html"><a href="studyIII.html#subject-predictors-table"><i class="fa fa-check"></i><b>5.6.2</b> Subject predictors table</a></li>
<li class="chapter" data-level="5.6.3" data-path="studyIII.html"><a href="studyIII.html#plot-1"><i class="fa fa-check"></i><b>5.6.3</b> Plot</a></li>
<li class="chapter" data-level="5.6.4" data-path="studyIII.html"><a href="studyIII.html#probability-tables"><i class="fa fa-check"></i><b>5.6.4</b> Probability tables</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Online appendix for the paper: “Bayesian Paired-Comparison with the bpcs package”</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="basics" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Basic functionality</h1>
<p>Although a large overview of the functionality of the <code>bpcs</code> is available in the official documentation (<a href="https://davidissamattos.github.io/bpcs" class="uri">https://davidissamattos.github.io/bpcs</a>) we provide here a short example based on the paper:</p>
<blockquote>
<p>Luckett, Curtis R., Sara L. Burns, and Lindsay Jenkinson. “Estimates of relative acceptability from paired preference tests.” Journal of Sensory Studies 35.5 (2020): e12593.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="basics.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bpcs)</span>
<span id="cb4-2"><a href="basics.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-3"><a href="basics.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb4-4"><a href="basics.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb4-5"><a href="basics.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb4-6"><a href="basics.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">99</span>)</span></code></pre></div>
<div id="reading-and-preparing-the-data" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Reading and preparing the data</h2>
<p>This paper analyzes food preferences using paired comparisons (and compare different methods). The original data was made available in the paper and it can be found in the link:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="basics.html#cb5-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="at">path=</span><span class="st">&#39;data/PREF_DATA.xlsx&#39;</span>, <span class="at">sheet =</span> <span class="st">&#39;Pizza&#39;</span>)</span></code></pre></div>
<p>Below we see a fragment of how the dataset looks like:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="basics.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(d, <span class="at">size=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="basics.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption=</span><span class="st">&quot;Example of the pizza data frame&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="basics.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>))</span></code></pre></div>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-6">Table 2.1: </span>Example of the pizza data frame
</caption>
<thead>
<tr>
<th style="text-align:left;">
Prod1
</th>
<th style="text-align:left;">
Prod2
</th>
<th style="text-align:right;">
Win1
</th>
<th style="text-align:right;">
Win2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
21
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
13
</td>
</tr>
</tbody>
</table>
<p>This data is in a aggregated format. That is each row contains more than one observation. For example, the first row shows that Tombstone was voted 16 times against Red Barron and Red Barron was voted 21 times against Tombstone</p>
<p>To use with the bpcs package, we need to expand it to a single contest per row, in a long format. We can use the function <code>expand_aggregated_data</code> of the bpcs package exactly for this purpose.</p>
<p>This leads to a data frame with 380 rows (same number of wins for 1 and 2). This function adds an id column to the data, so each row is uniquely represented (important if you will do some transformations later). Below we examplify how the expanded data looks like</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="basics.html#cb7-1" aria-hidden="true" tabindex="-1"></a>dpizza <span class="ot">&lt;-</span> <span class="fu">expand_aggregated_data</span>(<span class="at">d =</span> d, <span class="at">player0 =</span> <span class="st">&#39;Prod1&#39;</span>, <span class="at">player1 =</span> <span class="st">&#39;Prod2&#39;</span>, <span class="at">wins0 =</span> <span class="st">&#39;Win1&#39;</span>, <span class="at">wins1 =</span> <span class="st">&#39;Win2&#39;</span>, <span class="at">keep=</span><span class="cn">NULL</span>)</span>
<span id="cb7-2"><a href="basics.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># renaming the columns</span></span>
<span id="cb7-3"><a href="basics.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dpizza) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Prod0&#39;</span>,<span class="st">&#39;Prod1&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;contest_id&#39;</span>)</span>
<span id="cb7-4"><a href="basics.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a short table to exemplify</span></span>
<span id="cb7-5"><a href="basics.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(dpizza, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="basics.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&#39;Sample of the expanded pizza data set&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="basics.html#cb7-7" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="basics.html#cb7-8" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:expand_data2)Sample of the expanded pizza data set
</caption>
<thead>
<tr>
<th style="text-align:left;">
Prod0
</th>
<th style="text-align:left;">
Prod1
</th>
<th style="text-align:right;">
y
</th>
<th style="text-align:right;">
contest_id
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
362
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
226
</td>
</tr>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
128
</td>
</tr>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
358
</td>
</tr>
<tr>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
269
</td>
</tr>
<tr>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
68
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
265
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
210
</td>
</tr>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
88
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="the-bayesian-bradley-terry-analysis" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> The Bayesian Bradley-Terry analysis</h2>
<p>Now that we have the data in the correct format we can use bpcs package to model the Bayesian Bradley-Terry Model. It is a good practice to save the result fitted model in a file right after sampling. Some models might take several minutes to fit and you probably don’t want to keep re-fitting the model always. After saving you can just read the model and continue your analysis instead of re-fitting. The <code>save_bpc_model</code> is a wrapper function around the <code>saveRDS</code> function with a few smaller checks. Few free to use any. To read you can use the <code>load_bpc_model</code> or the <code>readRDS</code> functions.</p>
<p>Let’s run the simplest Bayesian Bradley-Terry model:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="basics.html#cb8-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">bpc</span>(<span class="at">data =</span> dpizza,</span>
<span id="cb8-2"><a href="basics.html#cb8-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">player0 =</span> <span class="st">&#39;Prod0&#39;</span>,</span>
<span id="cb8-3"><a href="basics.html#cb8-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">player1 =</span> <span class="st">&#39;Prod1&#39;</span>,</span>
<span id="cb8-4"><a href="basics.html#cb8-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">result_column =</span> <span class="st">&#39;y&#39;</span>,</span>
<span id="cb8-5"><a href="basics.html#cb8-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">solve_ties =</span> <span class="st">&#39;none&#39;</span>,</span>
<span id="cb8-6"><a href="basics.html#cb8-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">model_type =</span> <span class="st">&#39;bt&#39;</span>,</span>
<span id="cb8-7"><a href="basics.html#cb8-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter=</span><span class="dv">3000</span>,</span>
<span id="cb8-8"><a href="basics.html#cb8-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_chain_messages =</span> T)</span>
<span id="cb8-9"><a href="basics.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">save_bpc_model</span>(m, <span class="st">&#39;pizza&#39;</span>,<span class="st">&#39;.bpcs&#39;</span>)</span></code></pre></div>
<p>To load:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="basics.html#cb9-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">load_bpc_model</span>(<span class="st">&#39;.bpcs/pizza.RDS&#39;</span>)</span></code></pre></div>
<div id="diagnostics" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Diagnostics</h3>
<p>After sampling, we can investigate the convergence of the model and the predictive posterior with shinystan.
Convergence checks are already available in the fitted model, but for the posterior checks we need to first calculate the posterior predictive values with the <code>posterior_predictive</code> function. This function returns a list with two values, the <code>y</code> (original fitted values) and the <code>y_pred</code> (posterior predictve). Both are in the correct format to use with shinystan.</p>
<p>We save them to the global environment and then we load it in shinystan directly (through the GUI).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="basics.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#posterior predictive check </span></span>
<span id="cb10-2"><a href="basics.html#cb10-2" aria-hidden="true" tabindex="-1"></a>y_pp <span class="ot">&lt;-</span> <span class="fu">posterior_predictive</span>(m)</span>
<span id="cb10-3"><a href="basics.html#cb10-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y_pp<span class="sc">$</span>y</span>
<span id="cb10-4"><a href="basics.html#cb10-4" aria-hidden="true" tabindex="-1"></a>y_pred <span class="ot">&lt;-</span> y_pp<span class="sc">$</span>y_pred</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="basics.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">launch_shinystan</span>(m)</span></code></pre></div>
<p>Since everything looks fine we can proceed with the analysis.</p>
<p>Alternatively, as a quick check we can use:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="basics.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_convergence_diagnostics</span>(m)</span></code></pre></div>
<pre><code>## Processing csv files: /Users/davidis/Google Drive/Studies/PhD/papers/bpcs-appendix/.bpcs/bt-202106021351-1-6490e6.csv, /Users/davidis/Google Drive/Studies/PhD/papers/bpcs-appendix/.bpcs/bt-202106021351-2-6490e6.csv, /Users/davidis/Google Drive/Studies/PhD/papers/bpcs-appendix/.bpcs/bt-202106021351-3-6490e6.csv, /Users/davidis/Google Drive/Studies/PhD/papers/bpcs-appendix/.bpcs/bt-202106021351-4-6490e6.csv
## 
## Checking sampler transitions treedepth.
## Treedepth satisfactory for all transitions.
## 
## Checking sampler transitions for divergences.
## No divergent transitions found.
## 
## Checking E-BFMI - sampler transitions HMC potential energy.
## E-BFMI satisfactory for all transitions.
## 
## Effective sample size satisfactory.
## 
## Split R-hat values satisfactory all parameters.
## 
## Processing complete, no problems detected.</code></pre>
<p>Traceplots</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="basics.html#cb14-1" aria-hidden="true" tabindex="-1"></a>draws<span class="ot">&lt;-</span> m<span class="sc">$</span>fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">&#39;lambda&#39;</span>))</span>
<span id="cb14-2"><a href="basics.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(posterior<span class="sc">::</span><span class="fu">as_draws</span>(draws)) <span class="sc">+</span> </span>
<span id="cb14-3"><a href="basics.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Traceplots&quot;</span>)</span></code></pre></div>
<p><img src="bpcs-appendix_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="summary-information" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Summary information</h3>
<p>The <code>summary</code> function in the command line provides some tables that help understand the model, such as the summary of the parameters, the probability of winning, and the ranking table.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="basics.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<pre><code>## Estimated baseline parameters with 95% HPD intervals:
## 
## Table: (\#tab:unnamed-chunk-11)Parameters estimates
## 
## Parameter              Mean   Median   HPD_lower   HPD_higher
## -------------------  ------  -------  ----------  -----------
## lambda[Tombstone]     -0.14    -0.11       -2.77         2.57
## lambda[DiGiorno]       0.33     0.34       -2.30         3.03
## lambda[Freschetta]     0.22     0.25       -2.42         2.97
## lambda[Red Barron]     0.24     0.26       -2.41         2.95
## lambda[aKroger]       -0.35    -0.32       -2.97         2.39
## NOTES:
## * A higher lambda indicates a higher team ability
## 
## Posterior probabilities:
## These probabilities are calculated from the predictive posterior distribution
## for all player combinations
## 
## 
## Table: (\#tab:unnamed-chunk-11)Estimated posterior probabilites
## 
## i            j             i_beats_j   j_beats_i
## -----------  -----------  ----------  ----------
## aKroger      DiGiorno           0.43        0.57
## aKroger      Freschetta         0.32        0.68
## aKroger      Red Barron         0.39        0.61
## aKroger      Tombstone          0.41        0.59
## DiGiorno     Freschetta         0.55        0.45
## DiGiorno     Red Barron         0.45        0.55
## DiGiorno     Tombstone          0.69        0.31
## Freschetta   Red Barron         0.52        0.48
## Freschetta   Tombstone          0.57        0.43
## Red Barron   Tombstone          0.59        0.41
## 
## Rank of the players&#39; abilities:
## The rank is based on the posterior rank distribution of the lambda parameter
## 
## Table: (\#tab:unnamed-chunk-11)Estimated posterior ranks
## 
## Parameter     MedianRank   MeanRank   StdRank
## -----------  -----------  ---------  --------
## DiGiorno               1       1.64      0.77
## Freschetta             2       2.24      0.84
## Red Barron             2       2.22      0.85
## Tombstone              4       4.07      0.52
## aKroger                5       4.84      0.37</code></pre>
<p>The presented tables can also be obtained individually as data frame. Additionally, for all of them it is possible to obtain the posterior distribution.</p>
<p>The package has some publication-ready functions to create plots and tables. The format option can set it to latex, html, pandoc etc.</p>
<p>Parameters with HPDI</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="basics.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_parameters_table</span>(m, <span class="at">format=</span><span class="st">&#39;html&#39;</span>, <span class="at">caption =</span> <span class="st">&#39;Parameter estimates with HPDI&#39;</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-12">Table 2.2: </span>Parameter estimates with HPDI
</caption>
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Median
</th>
<th style="text-align:right;">
HPD_lower
</th>
<th style="text-align:right;">
HPD_higher
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
lambda[Tombstone]
</td>
<td style="text-align:right;">
-0.136
</td>
<td style="text-align:right;">
-0.113
</td>
<td style="text-align:right;">
-2.775
</td>
<td style="text-align:right;">
2.573
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[DiGiorno]
</td>
<td style="text-align:right;">
0.329
</td>
<td style="text-align:right;">
0.344
</td>
<td style="text-align:right;">
-2.304
</td>
<td style="text-align:right;">
3.026
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Freschetta]
</td>
<td style="text-align:right;">
0.223
</td>
<td style="text-align:right;">
0.249
</td>
<td style="text-align:right;">
-2.425
</td>
<td style="text-align:right;">
2.970
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[Red Barron]
</td>
<td style="text-align:right;">
0.240
</td>
<td style="text-align:right;">
0.261
</td>
<td style="text-align:right;">
-2.412
</td>
<td style="text-align:right;">
2.949
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda[aKroger]
</td>
<td style="text-align:right;">
-0.348
</td>
<td style="text-align:right;">
-0.318
</td>
<td style="text-align:right;">
-2.974
</td>
<td style="text-align:right;">
2.387
</td>
</tr>
</tbody>
</table>
<p>Probabilities</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="basics.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_probabilities_table</span>(m, <span class="at">format=</span><span class="st">&#39;html&#39;</span>, <span class="at">caption=</span><span class="st">&#39;Probability of selectiig a brand of pizza over the other&#39;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-13">Table 2.3: </span>Probability of selectiig a brand of pizza over the other
</caption>
<thead>
<tr>
<th style="text-align:left;">
i
</th>
<th style="text-align:left;">
j
</th>
<th style="text-align:right;">
i_beats_j
</th>
<th style="text-align:right;">
j_beats_i
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
0.69
</td>
</tr>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
0.46
</td>
<td style="text-align:right;">
0.54
</td>
</tr>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.50
</td>
</tr>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
0.45
</td>
</tr>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
0.69
</td>
<td style="text-align:right;">
0.31
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
0.46
</td>
<td style="text-align:right;">
0.54
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
0.43
</td>
</tr>
<tr>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
</tbody>
</table>
<p>Rank</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="basics.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_rank_of_players_table</span>(m, <span class="at">caption=</span><span class="st">&#39;Rank of Pizza&#39;</span>, <span class="at">format=</span><span class="st">&#39;html&#39;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-14">Table 2.4: </span>Rank of Pizza
</caption>
<thead>
<tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
MedianRank
</th>
<th style="text-align:right;">
MeanRank
</th>
<th style="text-align:right;">
StdRank
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
DiGiorno
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.666
</td>
<td style="text-align:right;">
0.801
</td>
</tr>
<tr>
<td style="text-align:left;">
Freschetta
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.314
</td>
<td style="text-align:right;">
0.847
</td>
</tr>
<tr>
<td style="text-align:left;">
Red Barron
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.129
</td>
<td style="text-align:right;">
0.837
</td>
</tr>
<tr>
<td style="text-align:left;">
Tombstone
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.046
</td>
<td style="text-align:right;">
0.546
</td>
</tr>
<tr>
<td style="text-align:left;">
aKroger
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4.845
</td>
<td style="text-align:right;">
0.370
</td>
</tr>
</tbody>
</table>
<p>Plot</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="basics.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m, <span class="at">rotate_x_labels=</span>T)</span></code></pre></div>
<p><img src="bpcs-appendix_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>We can also obtain information criteria to compare different models that fit the same data.</p>
<p>Below we show how to obtain the WAIC and the LOO-CV</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="basics.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_waic</span>(m)</span></code></pre></div>
<pre><code>## 
## Computed from 12000 by 380 log-likelihood matrix
## 
##           Estimate  SE
## elpd_waic   -259.8 3.9
## p_waic         4.0 0.1
## waic         519.6 7.8</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="basics.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_loo</span>(m)</span></code></pre></div>
<pre><code>## 
## Computed from 12000 by 380 log-likelihood matrix
## 
##          Estimate  SE
## elpd_loo   -259.8 3.9
## p_loo         4.0 0.1
## looic       519.6 7.8
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k &lt; 0.5).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>This chapter show some basic functionality of the package. The next chapters will show how to apply these functions to solve more interesting and complex problems. We also recommend checking the package documentation at: <a href="https://davidissamattos.github.io/bpcs/index.html" class="uri">https://davidissamattos.github.io/bpcs/index.html</a></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="studyI.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
